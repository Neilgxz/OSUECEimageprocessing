clear all 
close all
%% Board
I = imread('Board.jpg');
a=[ 290,28;
    170,316;
    673,65;
    703,477];
l=72;
w=68;
b=[2*l,2*w;
   1*l,4*w;
   9*l,1*w;
   9*l,7*w];
U=[ a(1,1),a(1,2),1 ,0      ,0      ,0 , -b(1,1)*a(1,1) , -b(1,1)*a(1,2) , -b(1,1);
    0      ,0      ,0  ,a(1,1),a(1,2),1, -b(1,2)*a(1,1) , -b(1,2)*a(1,2) , -b(1,2);
    a(2,1),a(2,2),1 ,0      ,0      ,0 , -b(2,1)*a(2,1) , -b(2,1)*a(2,2) , -b(2,1);
    0      ,0      ,0  ,a(2,1),a(2,2),1, -b(2,2)*a(2,1) , -b(2,2)*a(2,2) , -b(2,2);
    a(3,1),a(3,2),1 ,0      ,0      ,0 , -b(3,1)*a(3,1) , -b(3,1)*a(3,2) , -b(3,1);
    0      ,0      ,0  ,a(3,1),a(3,2),1, -b(3,2)*a(3,1) , -b(3,2)*a(3,2) , -b(3,2);
    a(4,1),a(4,2),1 ,0      ,0      ,0 , -b(4,1)*a(4,1) , -b(4,1)*a(4,2) , -b(4,1);
    0      ,0      ,0  ,a(4,1),a(4,2),1, -b(4,2)*a(4,1) , -b(4,2)*a(4,2) , -b(4,2)];
P=U'*U;
[V,D] = eig(P); 
H=V(:,1)./V(9,1);
H=reshape(H,[3,3]);
tform = projective2d(H);
I1= imwarp(I,tform);
figure
imshow(I1)
%% rig_original
image= imread('rig_original.jpg');
e=[14,13;
   186,9;
   187,167;
   19,188];
m=16;
n=17; 
c=[1*m,1*n;
   10*m,1*n;
   10*m,10*n;
   1*m,10*n];
Q=[ e(1,1),e(1,2),1  ,0      ,0      ,0 , -c(1,1)*e(1,1) , -c(1,1)*e(1,2) , -c(1,1);
    0      ,0    ,0  ,e(1,1) ,e(1,2),1  , -c(1,2)*e(1,1) , -c(1,2)*e(1,2) , -c(1,2);
    e(2,1),e(2,2),1  ,0       ,0     ,0 , -c(2,1)*e(2,1) , -c(2,1)*e(2,2) , -c(2,1);
    0      ,0    ,0  ,e(2,1),e(2,2) ,1  , -c(2,2)*e(2,1) , -c(2,2)*e(2,2) , -c(2,2);
    e(3,1),e(3,2),1 ,0      ,0      ,0  , -c(3,1)*e(3,1) , -c(3,1)*e(3,2) , -c(3,1);
    0      ,0      ,0  ,e(3,1),e(3,2),1 , -c(3,2)*e(3,1) , -c(3,2)*e(3,2) , -c(3,2);
    e(4,1),e(4,2),1 ,0      ,0      ,0  , -c(4,1)*e(4,1) , -c(4,1)*e(4,2) , -c(4,1);
    0      ,0      ,0  ,e(4,1),e(4,2),1 , -c(4,2)*e(4,1) , -c(4,2)*e(4,2) , -c(4,2)];
R=Q'*Q;
[V,D] = eig(R); 
H2=V(:,1)./V(9,1);
H2=reshape(H2,[3,3]);
tform1 = projective2d(H2);
image1= imwarp(image,tform1);
figure
imshow(image1)
